========== TEST test_upload_size_limits - Upload size limits validation ==========


---------- SUBTEST Clear cache ----------

ikup cache remove --all
Removed {{.*}} cached images

---------- SUBTEST Test file upload size limit with large image ----------

ikup display ./.cli-tests-data/wikipedia.png
_Gi=[[id:.*]],t=f,q=2,f=100,a=T,U=1,r=24,c=53;{{.*}}\
{{:SKIP_LINES:}}
ikup cache list ./.cli-tests-data/wikipedia.png
{{.*}} (mtime: {{.*}})
  PNG {{.*}} [[wikipedia_bytes:[0-9]+]] {{.*}}
{{:ASSERT: 12000 <= int(wikipedia_bytes) <= 15360}}

---------- SUBTEST Test stream upload size limit with large image ----------

ikup display ./.cli-tests-data/butterfly.jpg
_Gi=[[id2:.*]],q=2,m=0,a=t;\
{{:SKIP_LINES:}}
ikup cache list ./.cli-tests-data/butterfly.jpg
{{.*}} (mtime: {{.*}})
  JPEG {{.*}} [[butterfly_bytes:[0-9]+]] {{.*}}
{{:ASSERT: 8000 <= int(butterfly_bytes) <= 10240}}

---------- SUBTEST Test tiny upload limit forces heavy optimization ----------

ikup display ./.cli-tests-data/earth.jpg
_Gi=[[id3:.*]],t=f,q=2,f=100,a=T,U=1,r=18,c=35;{{.*}}\
{{:SKIP_LINES:}}
ikup cache list ./.cli-tests-data/earth.jpg
{{.*}} (mtime: {{.*}})
  JPEG {{.*}} [[earth_bytes:[0-9]+]] {{.*}}
{{:ASSERT: 800 <= int(earth_bytes) <= 1024}}
