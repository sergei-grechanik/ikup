========== TEST test_cache_basic - Basic cache functionality ==========


---------- SUBTEST Clear cache ----------

ikup cache remove --all
Removed {{.*}} cached images
ikup cache list
No cached images found.

---------- SUBTEST Test resizing to specific dimensions (WxH) ----------

ikup cache convert ./.cli-tests-data/earth.jpg -s 100x80
[[earth_cache_path:.*]]
ikup cache convert ./.cli-tests-data/butterfly.jpg --size 50x50 --format png
[[butterfly_cache_path:.*]]
ikup cache list
{{.*}}/butterfly.jpg (mtime: {{.*}})
  PNG 50x50 {{\d*}} [[butterfly_cache_path]]
{{.*}}/earth.jpg (mtime: {{.*}})
  JPEG 100x80 {{\d*}} [[earth_cache_path]]

---------- SUBTEST Test resizing with width only (automatic height) ----------

ikup cache convert ./.cli-tests-data/tux.png --width 64
[[tux_cache_path:.*]]
ikup cache convert ./.cli-tests-data/ruler.png --width 200 --format jpeg
[[ruler_cache_path:.*]]
ikup cache convert ./.cli-tests-data/ruler.png --width 100 --format jpeg
[[ruler_cache_path_100:.*]]
ikup cache list
{{.*}}/butterfly.jpg (mtime: {{.*}})
  PNG 50x50 {{\d*}} [[butterfly_cache_path]]
{{.*}}/earth.jpg (mtime: {{.*}})
  JPEG 100x80 {{\d*}} [[earth_cache_path]]
{{.*}}/ruler.png (mtime: {{.*}})
  JPEG 200x11 {{\d*}} [[ruler_cache_path]]
  JPEG 100x5 {{\d*}} [[ruler_cache_path_100]]
{{.*}}/tux.png (mtime: {{.*}})
  PNG 64x75 {{\d*}} [[tux_cache_path]]

---------- SUBTEST Test resizing with height only. Check idempotence. ----------

ikup cache convert ./.cli-tests-data/sun.jpg --height 75 --format png
[[sun_cache_date:.*]]
[[sun_cache_path:.*]] PNG 78x75 {{.*}}
ikup cache convert ./.cli-tests-data/sun.jpg --height 75 --format png
[[sun_cache_date]]
[[sun_cache_path:.*]] PNG 78x75 {{.*}}
ikup cache list
{{:SKIP_LINES:}}
{{.*}}/sun.jpg (mtime: {{.*}})
  PNG 78x75 {{\d*}} [[sun_cache_path]]
{{:SKIP_LINES:}}

---------- SUBTEST Test format conversion without resizing ----------

ikup cache convert ./.cli-tests-data/earth.jpg --format png
[[earth_png_cache_path:.*]]
ikup cache convert ./.cli-tests-data/tux.png --format jpeg
[[tux_jpeg_cache_path:.*]]
ikup cache list
{{:SKIP_LINES:}}
{{.*}}/earth.jpg (mtime: {{.*}})
  JPEG 100x80 {{\d*}} [[earth_cache_path]]
  PNG 240x240 {{\d*}} [[earth_png_cache_path]]
{{:SKIP_LINES:}}
{{.*}}/tux.png (mtime: {{.*}})
  PNG 64x75 {{\d*}} [[tux_cache_path]]
  JPEG 265x314 {{\d*}} [[tux_jpeg_cache_path]]
{{:SKIP_LINES:}}